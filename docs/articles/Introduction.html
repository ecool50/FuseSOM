<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="FuseSOM">
<title>FuseSOM package manual â€¢ FuseSOM</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="FuseSOM package manual">
<meta property="og:description" content="FuseSOM">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-dark"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">FuseSOM</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.3</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item">
  <a class="nav-link" href="../articles/Introduction.html">Getting started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/ecool50/FuseSOM/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>FuseSOM package manual</h1>
                        <h4 data-toc-skip class="author">Elijah
Willie</h4>
            
            <h4 data-toc-skip class="date">2023-08-10</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ecool50/FuseSOM/blob/HEAD/vignettes/Introduction.Rmd" class="external-link"><code>vignettes/Introduction.Rmd</code></a></small>
      <div class="d-none name"><code>Introduction.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://bioconductor.github.io/BiocManager/" class="external-link">"BiocManager"</a></span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"BiocManager"</span><span class="op">)</span></span>
<span><span class="fu">BiocManager</span><span class="fu">::</span><span class="fu"><a href="https://bioconductor.github.io/BiocManager/reference/install.html" class="external-link">install</a></span><span class="op">(</span><span class="st">"FuseSOM"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>A correlation based multiview self organizing map for the
characterization of cell types (<code>FuseSOM</code>) is a tool for
unsupervised clustering. <code>FuseSOM</code> is robust and achieves
high accuracy by combining a <code>Self Organizing Map</code>
architecture and a <code>Multiview</code> integration of correlation
based metrics to cluster highly multiplexed in situ imaging cytometry
assays. The <code>FuseSOM</code> pipeline has been streamlined and
accepts currently used data structures including
<code>SingleCellExperiment</code> and <code>SpatialExperiment</code>
objects as well as <code>DataFrames</code>.</p>
</div>
<div class="section level2">
<h2 id="disclaimer">Disclaimer<a class="anchor" aria-label="anchor" href="#disclaimer"></a>
</h2>
<p>This is purely a tool generated for clustering and as such it does
not provide any means for QC and feature selection. It is advisable that
the user first use other tools for quality control and feature selection
before running <code>FuseSOM</code>.</p>
</div>
<div class="section level2">
<h2 id="getting-started">Getting Started<a class="anchor" aria-label="anchor" href="#getting-started"></a>
</h2>
<div class="section level3">
<h3 id="fusesom-matrix-input">
<code>FuseSOM</code> Matrix Input<a class="anchor" aria-label="anchor" href="#fusesom-matrix-input"></a>
</h3>
<p>If you have a matrix containing expression data that was QCed and
normalised by some other tool, the next step is to run the
<code>FuseSOM</code> algorithm.This can be done by calling the
<code><a href="../reference/runFuseSOM.html">runFuseSOM()</a></code> function which takes in the matrix of interest
where the columns are markers and the rows are observations, the makers
of interest (if this is not provided, it is assumed that all columns are
markers), and the number of clusters.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load FuseSOM</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ecool50.github.io/FuseSOM/">FuseSOM</a></span><span class="op">)</span></span></code></pre></div>
<p>Next we will load in the <a href="https://www.sciencedirect.com/science/article/pii/S0092867421014860?via%3Dihub" class="external-link"><code>Risom et al</code></a>
dataset and run it through the FuseSOM pipeline. This dataset profiles
the spatial landscape of ductal carcinoma in situ (DCIS), which is a
pre-invasive lesion that is thought to be a precursor to invasive breast
cancer (IBC). The key conclusion of this manuscript (amongst others) is
that spatial information about cells can be used to predict disease
progression in patients.We will also be using the markers used in the
original study.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load in the data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"risom_dat"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># define the markers of interest</span></span>
<span><span class="va">risomMarkers</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'CD45'</span>,<span class="st">'SMA'</span>,<span class="st">'CK7'</span>,<span class="st">'CK5'</span>,<span class="st">'VIM'</span>,<span class="st">'CD31'</span>,<span class="st">'PanKRT'</span>,<span class="st">'ECAD'</span>,</span>
<span>                   <span class="st">'Tryptase'</span>,<span class="st">'MPO'</span>,<span class="st">'CD20'</span>,<span class="st">'CD3'</span>,<span class="st">'CD8'</span>,<span class="st">'CD4'</span>,<span class="st">'CD14'</span>,<span class="st">'CD68'</span>,<span class="st">'FAP'</span>,</span>
<span>                   <span class="st">'CD36'</span>,<span class="st">'CD11c'</span>,<span class="st">'HLADRDPDQ'</span>,<span class="st">'P63'</span>,<span class="st">'CD44'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># we will be using the manual_gating_phenotype as the true cell type to gauge </span></span>
<span><span class="co"># performance</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">risom_dat</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">risom_dat</span><span class="op">)</span> <span class="op">==</span> <span class="st">'manual_gating_phenotype'</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">'CellType'</span></span></code></pre></div>
<p>Now that we have loaded the data and define the markers of interest.
We can run the <code>FuseSOM</code> algorithm. We have provided a
function <code>runFuseSOM</code> that runs the pipeline from top to
bottom and returns the cluster labels as well as the
<code>Self Organizing Map</code> model.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">risomRes</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/runFuseSOM.html">runFuseSOM</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">risom_dat</span>, markers <span class="op">=</span> <span class="va">risomMarkers</span>, </span>
<span>                        numClusters <span class="op">=</span> <span class="fl">23</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## You have provided a dataset of class data.frame</span></span></code></pre>
<pre><code><span><span class="co">## Everything looks good. Now running the FuseSOM algorithm</span></span></code></pre>
<pre><code><span><span class="co">## Now Generating the Self Organizing Map Grid</span></span></code></pre>
<pre><code><span><span class="co">## Optimal Grid Size is: 8</span></span></code></pre>
<pre><code><span><span class="co">## Now Running the Self Organizing Map Model</span></span></code></pre>
<pre><code><span><span class="co">## Now Clustering the Prototypes</span></span></code></pre>
<pre><code><span><span class="co">## Loading required namespace: fastcluster</span></span></code></pre>
<pre><code><span><span class="co">## Now Mapping Clusters to the Original Data</span></span></code></pre>
<pre><code><span><span class="co">## The Prototypes have been Clustered and Mapped Successfully</span></span></code></pre>
<pre><code><span><span class="co">## The FuseSOM algorithm has completed successfully</span></span></code></pre>
<p>Lets look at the distribution of the clusters.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># get the distribution of the clusters</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">risomRes</span><span class="op">$</span><span class="va">clusters</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">risomRes</span><span class="op">$</span><span class="va">clusters</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">##   cluster_1  cluster_10  cluster_11  cluster_12  cluster_13  cluster_14 </span></span>
<span><span class="co">## 0.323602021 0.035968538 0.005439775 0.021443334 0.061100586 0.026596050 </span></span>
<span><span class="co">##  cluster_15  cluster_16  cluster_17  cluster_18  cluster_19   cluster_2 </span></span>
<span><span class="co">## 0.020582156 0.032624297 0.024931106 0.076128143 0.015802618 0.014927087 </span></span>
<span><span class="co">##  cluster_20  cluster_21  cluster_22  cluster_23   cluster_3   cluster_4 </span></span>
<span><span class="co">## 0.049962682 0.009185900 0.051771156 0.066913538 0.004923068 0.014108968 </span></span>
<span><span class="co">##   cluster_5   cluster_6   cluster_7   cluster_8   cluster_9 </span></span>
<span><span class="co">## 0.040776783 0.064444827 0.020854863 0.010032725 0.007879780</span></span></code></pre>
<p>Looks like <code>cluster_1</code> has about <span class="math inline">\(32\%\)</span> of the cells which is interesting.
Next, lets generate a heatmap of the marker expression for each
cluster.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">risomHeat</span> <span class="op">&lt;-</span> <span class="fu">FuseSOM</span><span class="fu">::</span><span class="fu"><a href="../reference/markerHeatmap.html">markerHeatmap</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">risom_dat</span>, markers <span class="op">=</span> <span class="va">risomMarkers</span>,</span>
<span>                            clusters <span class="op">=</span> <span class="va">risomRes</span><span class="op">$</span><span class="va">clusters</span>, clusterMarkers <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="Introduction_files/figure-html/unnamed-chunk-6-1.png" width="576" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="using-fusesom-to-estimate-the-number-of-clusters">Using <code>FuseSOM</code> to estimate the number of clusters<a class="anchor" aria-label="anchor" href="#using-fusesom-to-estimate-the-number-of-clusters"></a>
</h3>
<p><code>FuseSOM</code> also provides functionality for estimating the
number of clusters in a dataset using three classes of methods
including:</p>
<ol style="list-style-type: decimal">
<li>Discriminant based method.
<ul>
<li>A method developed in house based on discriminant based maximum
clusterability projection pursuit</li>
</ul>
</li>
<li>Distance based methods which includes:
<ul>
<li>The Gap Statistic</li>
<li>The Jump Statistic</li>
<li>The Slope Statistic</li>
<li>The Within Cluster Dissimilarity Statistic</li>
<li>The Silhouette Statistic</li>
</ul>
</li>
</ol>
<p>We can estimate the number of clusters using the
<code>estimateNumCluster</code>. Run
<code><a href="../reference/estimateNumCluster.html">help(estimateNumCluster)</a></code> to see itâ€™s complete
functionality.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># lets estimate the number of clusters using all the methods</span></span>
<span><span class="co"># original clustering has 23 clusters so we will set kseq from 2:25</span></span>
<span><span class="co"># we pass it the som model generated in the previous step</span></span>
<span><span class="va">risomKest</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/estimateNumCluster.html">estimateNumCluster</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">risomRes</span><span class="op">$</span><span class="va">model</span>, kSeq <span class="op">=</span> <span class="fl">2</span><span class="op">:</span><span class="fl">25</span>, </span>
<span>                                  method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Discriminant"</span>, <span class="st">"Distance"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Now Computing the Number of Clusters using Discriminant Analysis</span></span></code></pre>
<pre><code><span><span class="co">## Now Computing The Number Of Clusters Using Distance Analysis</span></span></code></pre>
<p>We can then use this result to determine the best number of clusters
for this dataset based on the different metrics. The
<code>FuseSOM</code> package provides a plotting function
(<code>optiPlot</code>) which generates an elbow plot with the optimal
value for the number of clusters for the distance based methods. See
below</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># what is the best number of clusters determined by the discriminant method?</span></span>
<span><span class="co"># optimal number of clusters according to the discriminant method is 7</span></span>
<span><span class="va">risomKest</span><span class="op">$</span><span class="va">Discriminant</span> </span></code></pre></div>
<pre><code><span><span class="co">## [1] 10</span></span></code></pre>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># we can plot the results using the optiplot function</span></span>
<span><span class="va">pSlope</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/optiPlot.html">optiPlot</a></span><span class="op">(</span><span class="va">risomKest</span>, method <span class="op">=</span> <span class="st">'slope'</span><span class="op">)</span></span>
<span><span class="va">pSlope</span></span></code></pre></div>
<p><img src="Introduction_files/figure-html/unnamed-chunk-8-1.png" width="576" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pJump</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/optiPlot.html">optiPlot</a></span><span class="op">(</span><span class="va">risomKest</span>, method <span class="op">=</span> <span class="st">'jump'</span><span class="op">)</span></span>
<span><span class="va">pJump</span></span></code></pre></div>
<p><img src="Introduction_files/figure-html/unnamed-chunk-8-2.png" width="576" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pWcd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/optiPlot.html">optiPlot</a></span><span class="op">(</span><span class="va">risomKest</span>, method <span class="op">=</span> <span class="st">'wcd'</span><span class="op">)</span></span>
<span><span class="va">pWcd</span></span></code></pre></div>
<p><img src="Introduction_files/figure-html/unnamed-chunk-8-3.png" width="576" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pGap</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/optiPlot.html">optiPlot</a></span><span class="op">(</span><span class="va">risomKest</span>, method <span class="op">=</span> <span class="st">'gap'</span><span class="op">)</span></span>
<span><span class="va">pGap</span></span></code></pre></div>
<p><img src="Introduction_files/figure-html/unnamed-chunk-8-4.png" width="576" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pSil</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/optiPlot.html">optiPlot</a></span><span class="op">(</span><span class="va">risomKest</span>, method <span class="op">=</span> <span class="st">'silhouette'</span><span class="op">)</span></span>
<span><span class="va">pSil</span></span></code></pre></div>
<p><img src="Introduction_files/figure-html/unnamed-chunk-8-5.png" width="576" style="display: block; margin: auto;">
From the plots, we see that the <code>Jump</code> statistics almost
perfectly capture the number of clusters. The <code>Gap</code> method is
a close second with <span class="math inline">\(15\)</span> clusters.
All the other methods significantly underestimates the number of
clusters.</p>
</div>
<div class="section level3">
<h3 id="fusesom-sinlge-cell-epxeriment-object-as-input-">
<code>FuseSOM</code> Sinlge Cell Epxeriment object as input.<a class="anchor" aria-label="anchor" href="#fusesom-sinlge-cell-epxeriment-object-as-input-"></a>
</h3>
<p>The <code>FuseSOM</code> algorithm is also equipped to take in a
<code>SingleCellExperiment</code> object as input. The results of the
pipeline will be written to either the metada or the colData fields. See
below.</p>
<p>First we create a <code>SingleCellExperiment</code> object</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">SingleCellExperiment</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create a singelcellexperiment object</span></span>
<span><span class="va">colDat</span> <span class="op">&lt;-</span> <span class="va">risom_dat</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">setdiff</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">risom_dat</span><span class="op">)</span>, <span class="va">risomMarkers</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">sce</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/SingleCellExperiment/man/SingleCellExperiment.html" class="external-link">SingleCellExperiment</a></span><span class="op">(</span>assays <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>counts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">risom_dat</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                                 colData <span class="op">=</span> <span class="va">colDat</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sce</span></span></code></pre></div>
<pre><code><span><span class="co">## class: SingleCellExperiment </span></span>
<span><span class="co">## dim: 23 69672 </span></span>
<span><span class="co">## metadata(0):</span></span>
<span><span class="co">## assays(1): counts</span></span>
<span><span class="co">## rownames(23): CD45 SMA ... CD44 CellType</span></span>
<span><span class="co">## rowData names(0):</span></span>
<span><span class="co">## colnames: NULL</span></span>
<span><span class="co">## colData names(1): X</span></span>
<span><span class="co">## reducedDimNames(0):</span></span>
<span><span class="co">## mainExpName: NULL</span></span>
<span><span class="co">## altExpNames(0):</span></span></code></pre>
<p>Next we pass it to the <code><a href="../reference/runFuseSOM.html">runFuseSOM()</a></code> function. Here, we
can provide the assay in which the data is stored and what name to store
the clusters under in the colData section. Note that the
<code>Self Organizing Map</code> that is generated will be stored in the
metadata field.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">risomRessce</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/runFuseSOM.html">runFuseSOM</a></span><span class="op">(</span><span class="va">sce</span>, markers <span class="op">=</span> <span class="va">risomMarkers</span>, assay <span class="op">=</span> <span class="st">'counts'</span>, </span>
<span>                      numClusters <span class="op">=</span> <span class="fl">23</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## You have provided a dataset of class SingleCellExperiment</span></span></code></pre>
<pre><code><span><span class="co">## Everything looks good. Now running the FuseSOM algorithm</span></span></code></pre>
<pre><code><span><span class="co">## Now Generating the Self Organizing Map Grid</span></span></code></pre>
<pre><code><span><span class="co">## Optimal Grid Size is: 8</span></span></code></pre>
<pre><code><span><span class="co">## Now Running the Self Organizing Map Model</span></span></code></pre>
<pre><code><span><span class="co">## Now Clustering the Prototypes</span></span></code></pre>
<pre><code><span><span class="co">## Now Mapping Clusters to the Original Data</span></span></code></pre>
<pre><code><span><span class="co">## The Prototypes have been Clustered and Mapped Successfully</span></span></code></pre>
<pre><code><span><span class="co">## The FuseSOM algorithm has completed successfully</span></span></code></pre>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">colData</a></span><span class="op">(</span><span class="va">risomRessce</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "X"        "clusters"</span></span></code></pre>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu">metadata</span><span class="op">(</span><span class="va">risomRessce</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "SOM"</span></span></code></pre>
<p>Notice how the there is now a clusters column in the colData and SOM
field in the metadata. You can run this function again with a new set of
cluster number. If you provide a new name for the clusters, it will be
stored under that new column, else, it will overwrite the current
clusters column. Running it again on the same object will overwrite the
SOM field in the metadata.</p>
<p>Just like before, lets plot the heatmap of the resulting clusters
across all markers.</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">risom_dat</span><span class="op">[</span>, <span class="va">risomMarkers</span><span class="op">]</span> <span class="co"># get the original data used</span></span>
<span><span class="va">clusters</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">colData</a></span><span class="op">(</span><span class="va">risomRessce</span><span class="op">)</span><span class="op">$</span><span class="va">clusters</span> <span class="co"># extract the clusters from the sce object</span></span>
<span><span class="co"># generate the heatmap</span></span>
<span><span class="va">risomHeatsce</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/markerHeatmap.html">markerHeatmap</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">risom_dat</span>, markers <span class="op">=</span> <span class="va">risomMarkers</span>,</span>
<span>                            clusters <span class="op">=</span> <span class="va">clusters</span>, clusterMarkers <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="Introduction_files/figure-html/unnamed-chunk-11-1.png" width="576" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="using-fusesom-to-estimate-the-number-of-clusters-for-single-cell-experiment-objects">Using <code>FuseSOM</code> to estimate the number of clusters for
single cell experiment objects<a class="anchor" aria-label="anchor" href="#using-fusesom-to-estimate-the-number-of-clusters-for-single-cell-experiment-objects"></a>
</h3>
<p>Just like before, we can estimate the number of clusters</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># lets estimate the number of clusters using all the methods</span></span>
<span><span class="co"># original clustering has 23 clusters so we will set kseq from 2:25</span></span>
<span><span class="co"># now we pass it a singlecellexperiment object instead of the som model as before</span></span>
<span><span class="co"># this will return a singelcellexperiment object where the metatdata contains the</span></span>
<span><span class="co"># cluster estimation information</span></span>
<span><span class="va">risomRessce</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/estimateNumCluster.html">estimateNumCluster</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">risomRessce</span>, kSeq <span class="op">=</span> <span class="fl">2</span><span class="op">:</span><span class="fl">25</span>, </span>
<span>                                  method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Discriminant"</span>, <span class="st">"Distance"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## You have provided a dataset of class: SingleCellExperiment</span></span></code></pre>
<pre><code><span><span class="co">## Now Computing the Number of Clusters using Discriminant Analysis</span></span></code></pre>
<pre><code><span><span class="co">## Now Computing The Number Of Clusters Using Distance Analysis</span></span></code></pre>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu">metadata</span><span class="op">(</span><span class="va">risomRessce</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "SOM"               "clusterEstimation"</span></span></code></pre>
<p>Notice how the metadata now contains a <code>clusterEstimation</code>
field which holds the results from the <code><a href="../reference/estimateNumCluster.html">estimateNumCluster()</a></code>
function</p>
<p>We can assess the results in a similar fashion as before</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># what is the best number of clusters determined by the discriminant method?</span></span>
<span><span class="co"># optimal number of clusters according to the discriminant method is 8</span></span>
<span><span class="fu">metadata</span><span class="op">(</span><span class="va">risomRessce</span><span class="op">)</span><span class="op">$</span><span class="va">clusterEstimation</span><span class="op">$</span><span class="va">Discriminant</span> </span></code></pre></div>
<pre><code><span><span class="co">## [1] 10</span></span></code></pre>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># we can plot the results using the optiplot function</span></span>
<span><span class="va">pSlope</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/optiPlot.html">optiPlot</a></span><span class="op">(</span><span class="va">risomRessce</span>, method <span class="op">=</span> <span class="st">'slope'</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## You have provided a dataset of class: SingleCellExperiment</span></span></code></pre>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pSlope</span></span></code></pre></div>
<p><img src="Introduction_files/figure-html/unnamed-chunk-13-1.png" width="576" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pJump</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/optiPlot.html">optiPlot</a></span><span class="op">(</span><span class="va">risomRessce</span>, method <span class="op">=</span> <span class="st">'jump'</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## You have provided a dataset of class: SingleCellExperiment</span></span></code></pre>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pJump</span></span></code></pre></div>
<p><img src="Introduction_files/figure-html/unnamed-chunk-13-2.png" width="576" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pWcd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/optiPlot.html">optiPlot</a></span><span class="op">(</span><span class="va">risomRessce</span>, method <span class="op">=</span> <span class="st">'wcd'</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## You have provided a dataset of class: SingleCellExperiment</span></span></code></pre>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pWcd</span></span></code></pre></div>
<p><img src="Introduction_files/figure-html/unnamed-chunk-13-3.png" width="576" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pGap</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/optiPlot.html">optiPlot</a></span><span class="op">(</span><span class="va">risomRessce</span>, method <span class="op">=</span> <span class="st">'gap'</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## You have provided a dataset of class: SingleCellExperiment</span></span></code></pre>
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pGap</span></span></code></pre></div>
<p><img src="Introduction_files/figure-html/unnamed-chunk-13-4.png" width="576" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pSil</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/optiPlot.html">optiPlot</a></span><span class="op">(</span><span class="va">risomRessce</span>, method <span class="op">=</span> <span class="st">'silhouette'</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## You have provided a dataset of class: SingleCellExperiment</span></span></code></pre>
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pSil</span></span></code></pre></div>
<p><img src="Introduction_files/figure-html/unnamed-chunk-13-5.png" width="576" style="display: block; margin: auto;">
Again, we see that the <code>Jump</code> statistics almost perfectly
capture the number of clusters. The <code>Gap</code> method is a close
second with <span class="math inline">\(15\)</span> clusters. All the
other methods significantly underestimates the number of clusters.</p>
</div>
<div class="section level3">
<h3 id="fusesom-spatial-epxeriment-object-as-input-">
<code>FuseSOM</code> Spatial Epxeriment object as input.<a class="anchor" aria-label="anchor" href="#fusesom-spatial-epxeriment-object-as-input-"></a>
</h3>
<p>The methodology for <code>Spatial Epxeriment</code> is exactly the
same as that of <code>Single Cell Epxeriment</code></p>
</div>
</div>
<div class="section level2">
<h2 id="sessioninfo">sessionInfo()<a class="anchor" aria-label="anchor" href="#sessioninfo"></a>
</h2>
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## R version 4.3.1 (2023-06-16)</span></span>
<span><span class="co">## Platform: x86_64-pc-linux-gnu (64-bit)</span></span>
<span><span class="co">## Running under: Debian GNU/Linux 12 (bookworm)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Matrix products: default</span></span>
<span><span class="co">## BLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3 </span></span>
<span><span class="co">## LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/libopenblasp-r0.3.21.so;  LAPACK version 3.11.0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## locale:</span></span>
<span><span class="co">##  [1] LC_CTYPE=C.UTF-8       LC_NUMERIC=C           LC_TIME=C.UTF-8       </span></span>
<span><span class="co">##  [4] LC_COLLATE=C.UTF-8     LC_MONETARY=C.UTF-8    LC_MESSAGES=C.UTF-8   </span></span>
<span><span class="co">##  [7] LC_PAPER=C.UTF-8       LC_NAME=C              LC_ADDRESS=C          </span></span>
<span><span class="co">## [10] LC_TELEPHONE=C         LC_MEASUREMENT=C.UTF-8 LC_IDENTIFICATION=C   </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## time zone: Australia/Sydney</span></span>
<span><span class="co">## tzcode source: system (glibc)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## attached base packages:</span></span>
<span><span class="co">## [1] stats4    stats     graphics  grDevices utils     datasets  methods  </span></span>
<span><span class="co">## [8] base     </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## other attached packages:</span></span>
<span><span class="co">##  [1] SingleCellExperiment_1.23.0 SummarizedExperiment_1.31.1</span></span>
<span><span class="co">##  [3] Biobase_2.61.0              GenomicRanges_1.53.1       </span></span>
<span><span class="co">##  [5] GenomeInfoDb_1.37.2         IRanges_2.35.2             </span></span>
<span><span class="co">##  [7] S4Vectors_0.39.1            BiocGenerics_0.47.0        </span></span>
<span><span class="co">##  [9] MatrixGenerics_1.13.1       matrixStats_1.0.0          </span></span>
<span><span class="co">## [11] FuseSOM_1.1.3               knitr_1.43                 </span></span>
<span><span class="co">## [13] BiocStyle_2.29.1           </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## loaded via a namespace (and not attached):</span></span>
<span><span class="co">##   [1] mnormt_2.1.1             bitops_1.0-7             permute_0.9-7           </span></span>
<span><span class="co">##   [4] rlang_1.1.1              magrittr_2.0.3           compiler_4.3.1          </span></span>
<span><span class="co">##   [7] flexmix_2.3-19           mgcv_1.9-0               analogue_0.17-6         </span></span>
<span><span class="co">##  [10] systemfonts_1.0.4        vctrs_0.6.3              stringr_1.5.0           </span></span>
<span><span class="co">##  [13] pkgconfig_2.0.3          crayon_1.5.2             fastmap_1.1.1           </span></span>
<span><span class="co">##  [16] backports_1.4.1          XVector_0.41.1           labeling_0.4.2          </span></span>
<span><span class="co">##  [19] utf8_1.2.3               rmarkdown_2.23           ragg_1.2.5              </span></span>
<span><span class="co">##  [22] purrr_1.0.1              coop_0.6-3               modeltools_0.2-23       </span></span>
<span><span class="co">##  [25] xfun_0.39                zlibbioc_1.47.0          cachem_1.0.8            </span></span>
<span><span class="co">##  [28] jsonlite_1.8.7           highr_0.10               DelayedArray_0.27.10    </span></span>
<span><span class="co">##  [31] fpc_2.2-10               psych_2.3.6              prabclus_2.3-2          </span></span>
<span><span class="co">##  [34] broom_1.0.5              parallel_4.3.1           cluster_2.1.4           </span></span>
<span><span class="co">##  [37] R6_2.5.1                 profileModel_0.6.1       bslib_0.5.0             </span></span>
<span><span class="co">##  [40] stringi_1.7.12           RColorBrewer_1.1-3       car_3.1-2               </span></span>
<span><span class="co">##  [43] diptest_0.76-0           jquerylib_0.1.4          Rcpp_1.0.11             </span></span>
<span><span class="co">##  [46] bookdown_0.34            nnet_7.3-19              Matrix_1.5-3            </span></span>
<span><span class="co">##  [49] splines_4.3.1            tidyselect_1.2.0         abind_1.4-5             </span></span>
<span><span class="co">##  [52] yaml_2.3.7               vegan_2.6-4              brglm_0.7.2             </span></span>
<span><span class="co">##  [55] lattice_0.21-8           tibble_3.2.1             withr_2.5.0             </span></span>
<span><span class="co">##  [58] evaluate_0.21            gridGraphics_0.5-1       desc_1.4.2              </span></span>
<span><span class="co">##  [61] proxy_0.4-27             kernlab_0.9-32           mclust_6.0.0            </span></span>
<span><span class="co">##  [64] pillar_1.9.0             BiocManager_1.30.21.1    ggpubr_0.6.0            </span></span>
<span><span class="co">##  [67] carData_3.0-5            generics_0.1.3           rprojroot_2.0.3         </span></span>
<span><span class="co">##  [70] sp_2.0-0                 RCurl_1.98-1.12          ggplot2_3.4.2           </span></span>
<span><span class="co">##  [73] munsell_0.5.0            scales_1.2.1             princurve_2.1.6         </span></span>
<span><span class="co">##  [76] class_7.3-22             glue_1.6.2               pheatmap_1.0.12         </span></span>
<span><span class="co">##  [79] tools_4.3.1              robustbase_0.99-0        ggsignif_0.6.4          </span></span>
<span><span class="co">##  [82] fastcluster_1.2.3        fs_1.6.3                 grid_4.3.1              </span></span>
<span><span class="co">##  [85] tidyr_1.3.0              colorspace_2.1-0         nlme_3.1-162            </span></span>
<span><span class="co">##  [88] GenomeInfoDbData_1.2.10  cli_3.6.1                textshaping_0.3.6       </span></span>
<span><span class="co">##  [91] DataVisualizations_1.3.1 FCPS_1.3.3               fansi_1.0.4             </span></span>
<span><span class="co">##  [94] S4Arrays_1.1.5           dplyr_1.1.2              DEoptimR_1.1-0          </span></span>
<span><span class="co">##  [97] gtable_0.3.3             rstatix_0.7.2            yulab.utils_0.0.6       </span></span>
<span><span class="co">## [100] sass_0.4.7               digest_0.6.33            SparseArray_1.1.11      </span></span>
<span><span class="co">## [103] ggplotify_0.1.1          farver_2.1.1             memoise_2.0.1           </span></span>
<span><span class="co">## [106] htmltools_0.5.5          pkgdown_2.0.7            lifecycle_1.0.3         </span></span>
<span><span class="co">## [109] MASS_7.3-60</span></span></code></pre>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Elijah Willie.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
